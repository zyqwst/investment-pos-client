webpackJsonp([14],{KFkD:function(e,t){},WrH6:function(e,t){},oIKZ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Xxa5"),r=a.n(n),l=a("exGp"),s=a.n(l),o=a("7L0k"),i=a("2BUL"),c=a("VvTn"),u={data:function(){return{loading:!1,showDtlDialog:!1,searchValue:"",currentPage:1,sales:[],selectSale:{},dtls:[],dateRange:[Object(i.a)(new Date),Object(i.a)(new Date)],pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){var t=new Date,a=new Date;e.$emit("pick",[a,t])}},{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}}]}}},watch:{currentPage:function(){this.query()},searchValue:_.debounce(function(){this.query()},500),dateRange:_.debounce(function(){this.query()},500)},computed:{saleMan:function(){return function(e){return"（"+e.saleManCode+"）"+e.saleManName}},tableHeight:function(){return window.innerHeight-160},priceIcon:function(){var e={1:"gift",2:"cu-price",3:"vip-price",4:"retail-price"};return function(t){return e[t]}}},methods:{query:function(){var e=this;return s()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,Object(o.j)(e.searchValue,e.dateRange[0],e.dateRange[1],e.currentPage-1);case 4:a=t.sent,e.sales=a.object;case 6:return t.prev=6,e.loading=!1,t.finish(6);case 9:case"end":return t.stop()}},t,e,[[0,,6,9]])}))()},toPage:function(e){this.currentPage=e},showDtl:function(e){var t=this;return s()(r.a.mark(function a(){var n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.selectSale=e,a.prev=1,t.loading=!0,a.next=5,Object(o.i)(e.id);case 5:n=a.sent,t.dtls=n.object,console.info(t.showDtlDialog),t.showDtlDialog=!0;case 9:return a.prev=9,t.loading=!1,a.finish(9);case 12:case"end":return a.stop()}},a,t,[[1,,9,12]])}))()},showRefund:function(e){this.$router.push({name:"refund",params:{saleId:e.id}})},getSummaries:function(e){var t=[],a=e.columns,n=e.data;return a.forEach(function(e,a){if(0!==a){var r=n.map(function(t){return Number(t[e.property])});5===a&&(t[a]=r.reduce(function(e,t){return Object(c.a)(e,t)},0),t[a]+=" 元")}else t[a]="合计"}),t}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"sale-query"},[a("el-row",[a("el-col",{attrs:{span:6,offset:2}},[a("sy-input",{ref:"searchInput",staticClass:"search-value",attrs:{prefix:"",suffix:e.searchValue.length>0,placeholder:"会员卡/手机号/订单号"},on:{prefix:e.query},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}})],1),e._v(" "),a("el-col",{attrs:{span:8,offset:1}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions,clearable:!1,editable:!1},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:22,offset:1}},[a("el-table",{attrs:{data:e.sales.content,stripe:"","highlight-current-row":"",height:e.tableHeight,"show-summary":"","summary-method":e.getSummaries}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"销售单号:"}},[a("span",[e._v(e._s(t.row.billno))])]),e._v(" "),a("el-form-item",{attrs:{label:"会员电话:"}},[a("span",[e._v(e._s(t.row.phone))])]),e._v(" "),a("el-form-item",{attrs:{label:"收银员:"}},[a("span",[e._v(e._s(e.saleMan(t.row)))])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"creDate",label:"销售日期"}}),e._v(" "),a("el-table-column",{attrs:{prop:"memberCode",label:"会员卡"}}),e._v(" "),a("el-table-column",{attrs:{prop:"memberName",label:"会员名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dtls",label:"商品数"}}),e._v(" "),a("el-table-column",{attrs:{align:"right",prop:"amount",label:"销售金额"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",icon:"el-icon-tickets",circle:""},nativeOn:{click:function(a){a.preventDefault(),e.showDtl(t.row)}}}),e._v(" "),a("el-button",{attrs:{type:"primary",circle:""},nativeOn:{click:function(a){a.preventDefault(),e.showRefund(t.row)}}},[e._v("退")])]}}])})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-pagination",{staticClass:"mt-2",attrs:{background:"",layout:"total, prev, pager, next",pageCount:e.sales.totalPages,total:e.sales.totalElements,pageSize:e.sales.size,currentPage:e.currentPage},on:{currentChange:e.toPage,"update:currentPage":function(t){e.currentPage=t}}})],1),e._v(" "),a("el-dialog",{staticClass:"query-sale-dtl-dialog",attrs:{title:"订单明细",visible:e.showDtlDialog,"append-to-body":!0},on:{"update:visible":function(t){e.showDtlDialog=t}}},[a("div",[a("el-table",{attrs:{data:e.dtls,stripe:"","highlight-current-row":"",height:"60vh"}},[a("el-table-column",{attrs:{prop:"name",label:"商品"}}),e._v(" "),a("el-table-column",{attrs:{align:"left",label:"单价"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("svg-icon",{staticClass:"retail-price",attrs:{"icon-class":e.priceIcon(t.row.type)}}),e._v(e._s(t.row.price))],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"qty",label:"数量"}}),e._v(" "),a("el-table-column",{attrs:{prop:"refundQty",label:"退货数量"}})],1)],1)])],1)},staticRenderFns:[]};var f=a("VU/8")(u,p,!1,function(e){a("KFkD"),a("WrH6")},"data-v-1df3fa68",null);t.default=f.exports}});